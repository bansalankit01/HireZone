const carddata = [
  {
    companyName: "Ninestars Information Technologies",
    imagesrc:
      "https://images.jdmagicbox.com/v2/comp/bangalore/37/080p5907337/catalogue/ninestar-information-technologies-pvt-ltd-jp-nagar-3rd-phase-bangalore-computer-software-developers-2f58bax.jpg",
    posted: "3 days ago",
    jobTitle: "UI/UX Designers",
    location: "Bengaluru",
    salary: "2,25,000 - 5,00,000",
    jobType: "Full-Time",
    shift: "Day shift",
  },
  {
    companyName: "VIATRIS",
    imagesrc:
      "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTW9nNJZClQqYkQse-vmz9zP9ELdk-LK3c8Qg&s",
    posted: "4 days ago",
    jobTitle: "Graduate Engineer Trainee",
    location: "Bengaluru",
    salary: "5,00,000",
    jobType: "Full-Time",
    shift: "Day shift",
  },
  {
    companyName: "infosys",
    imagesrc:
      "https://static.vecteezy.com/system/resources/previews/020/336/451/non_2x/infosys-logo-infosys-icon-free-free-vector.jpg",
    posted: "2 days ago",
    jobTitle: "Senior web developer",
    location: "Mumbai, India",
    salary: "3,00,000 - 5,00,000",
    jobType: "Full-Time",
    shift: "Day Shift",
  },
  {
    companyName: "to the new",
    imagesrc:
      "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTVmcrdWjk0nGrrmQV3Ugtu1D-keYlbShNn8g&s",
    posted: "4 days ago",
    jobTitle: "Software Engineer Trainee",
    location: "noida",
    salary: "Not disclosed",
    jobType: "Full-Time",
    shift: "Day shift",
  },
  {
    companyName: "Accenture",
    imagesrc:
      "https://logos-world.net/wp-content/uploads/2020/06/Accenture-Emblem.png",
    posted: "2 days ago",
    jobTitle: "Qualified developer",
    location: "Mumbai, India",
    salary: "5,00,000 - 7,00,000",
    jobType: "Full-Time",
    shift: "Flexible Shift",
  },
  {
    companyName: "IESoft Technologies Private Limited",
    imagesrc:
      "https://s3.ap-south-1.amazonaws.com/triedgenew/assets/uploads/position/1662467636_WhatsApp%20Image%202022-09-01%20at%2017.30.56.jpeg",
    posted: "Posted Today",
    jobTitle: "Software developer",
    location: "Work from home",
    salary: "4,00,000 - 6,00,000",
    jobType: "Full-Time",
    shift: "Day Shift",
  },
  {
    companyName: "Talent Organizers",
    imagesrc:
      "https://talentorganizers.in/wp-content/uploads/2022/07/Logo_wo_bg-1.png",
    posted: "5 days ago",
    jobTitle: "British Airways II Fresher's",
    location: "noida, gurugram, delhi NCR",
    salary: "2,00,000 - 7,00,000",
    jobType: "Full-Time",
    shift: "Day shift",
  },
  {
    companyName: "Genex Edge Solutions",
    imagesrc:
      "https://yt3.googleusercontent.com/LHZ-CpnI3ukDeDZWkdV3yIwPwr7cs3JwRFyvxevFVDDHtHmtQjTiOOjMS1voepznxtCp3R1Q=s900-c-k-c0x00ffffff-no-rj",
    posted: "2 days ago",
    jobTitle: "Shopify developer",
    location: "Delhi, India",
    salary: "2,00,000",
    jobType: "Part-Time",
    shift: "Fixed Shift",
  },
  {
    companyName: "KLJ Resources Limited",
    imagesrc:
      "https://media.licdn.com/dms/image/v2/D4D0BAQF27lrBtcuH8Q/company-logo_200_200/company-logo_200_200/0/1680669395027/klj_resources_ltd_logo?e=2147483647&v=beta&t=M2HkEofZPWknuW-Kzm6hrtLFqQVM9M1FIDtlAWALxdY",
    posted: "Posted Just Now",
    jobTitle: "Front End Developer",
    location: "Delhi, India",
    salary: "4,00,000 - 6,00,000",
    jobType: "Full-Time",
    shift: "Day Shift",
  },
  {
    companyName: "VHR Professional Services",
    imagesrc:
      "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQJExlm_KhRHO8TITYOewXOWzAo_y79Hhmvuw&s",
    posted: "4 days ago",
    jobTitle: "Data Entry Executive",
    location: "remote",
    salary: "8,00,000 - 10,00,000",
    jobType: "Full-Time",
    shift: "Day shift",
  },
  {
    companyName: "Techmindscape Private Limited",
    imagesrc:
      "https://media.licdn.com/dms/image/v2/D560BAQEJx06BWnMRfA/company-logo_200_200/company-logo_200_200/0/1719255827948?e=2147483647&v=beta&t=_IzB3aSvS-QTa3l1YUPPWAAgE22Ghuiupt9EL499sFA",
    posted: "2 days ago",
    jobTitle: "Reactjs developer",
    location: "Karnataka",
    salary: "2,40,000 - 3,00,000",
    jobType: "Full-Time",
    shift: "Day Shift",
  },
  {
    companyName: "Nexpro247",
    imagesrc:
      "https://media.licdn.com/dms/image/v2/D4D0BAQG6Nzqogn7miQ/company-logo_200_200/company-logo_200_200/0/1693824586826?e=2147483647&v=beta&t=LONSkwpKQpbu99GJvp_NN3QUiMadZo8lrKOP0iDCx6A",
    posted: "4 days ago",
    jobTitle: "Web Developer",
    location: "Ahmedabad, Surat, Vadodara",
    salary: "Not Disclosed",
    jobType: "Full-Time",
    shift: "Flexible Shift",
  },
  {
    companyName: "Evolutionco",
    imagesrc:
      "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSnTPnfJu-djskhwjKCAl8EZsSLBNWpAUcJKw&s",
    posted: "2 days ago",
    jobTitle: "Junior Ux Designer",
    location: "Mumbai (All Areas)",
    salary: "3,00,000 - 6,00,000",
    jobType: "Full-Time",
    shift: "Day shift",
  },
  {
    companyName: "Odisha Doot Consultants",
    imagesrc:
      "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRRuDeFwKsZBuq8C00GFXvFZstvsLzmijTQWg&s",
    posted: "2 days ago",
    jobTitle: "Fullstack Developer",
    location: "Bhubaneswar( Saheed Nagar )",
    salary: "not disclosed",
    jobType: "Full-Time",
    shift: "Flexible Shift",
  },
  {
    companyName: "Certbar Security",
    imagesrc:
      "https://media.licdn.com/dms/image/v2/D4D0BAQHOZsyJDLIXVw/company-logo_200_200/company-logo_200_200/0/1685471408998/certbar_logo?e=2147483647&v=beta&t=i4-h00dcR5_8pqlW6trOnVFfuASPQxOi4SIBdJxS6sM",
    posted: "5 days ago",
    jobTitle: "Jr . Creative Designer",
    location: "surat",
    salary: "not disclosed",
    jobType: "Full-Time",
    shift: "Flexible Shift",
  },
];

const jobsPerPage = 4; // Number of jobs to display per page
let currentPage = 1; // Start with the first page

function createJobCards(dataArray) {
  const container = document.getElementById("box-container");
  container.innerHTML = ""; // Clear previous results

  dataArray.forEach((data) => {
    const cardHTML = `
            <div class="box">
                <div class="company">
                    <img src="${data.imagesrc}" alt="${data.companyName}">
                    <div>
                        <h3>${data.companyName}</h3>
                        <p>${data.posted}</p>
                    </div>
                </div>
                <h3 class="job-title">${data.jobTitle}</h3>
                <p class="location"><i class="fas fa-map-marker-alt"></i> <span>${data.location}</span></p>
                <div class="tags">
                    <p><i class="fas fa-indian-rupee-sign"></i> <span>${data.salary}</span></p>
                    <p><i class="fas fa-briefcase"></i> <span>${data.jobType}</span></p>
                    <p><i class="fas fa-clock"></i> <span>${data.shift}</span></p>
                </div>
                <div class="flex-btn">
                    <a href="view_job.html" class="btn">view details</a>
                    <button type="submit" class="far fa-heart" name="save"></button>
                </div>
            </div>
        `;

    container.innerHTML += cardHTML;
  });
}

// Search and Filter Functionality

function parseSalary(salary) {
  // Extract numeric range from the salary string
  const match = salary.match(/(\d[\d,]*)\s*-\s*(\d[\d,]*)/);
  if (match) {
    return [
      parseInt(match[1].replace(/,/g, ""), 10),
      parseInt(match[2].replace(/,/g, ""), 10),
    ];
  } else if (salary.toLowerCase().includes("not disclosed")) {
    return null; // Skip jobs with "not disclosed" salary
  } else {
    // If it's a single salary value
    const singleSalary = parseInt(salary.replace(/,/g, ""), 10);
    return [singleSalary, singleSalary];
  }
}

function parseRange(rangeString) {
  // Convert dropdown range into numeric bounds
  const match = rangeString.match(/(\d[\d,]*)\s*-\s*(\d[\d,]*)/);
  if (match) {
    return [
      parseInt(match[1].replace(/,/g, ""), 10),
      parseInt(match[2].replace(/,/g, ""), 10),
    ];
  } else if (rangeString.toLowerCase().includes("less")) {
    return [0, 1000]; // Handle "1000 - less"
  } else {
    return null;
  }
}

function filterJobs(
  dataArray,
  title,
  location,
  datePosted,
  salaryRange,
  jobType,
  workShift
) {
  return dataArray.filter((job) => {
    const matchesTitle =
      title === "" ||
      job.jobTitle.toLowerCase().includes(title.toLowerCase()) ||
      job.companyName.toLowerCase().includes(title.toLowerCase());
    const matchesLocation =
      location === "" ||
      job.location.toLowerCase().includes(location.toLowerCase());
    const matchesDate =
      datePosted === "" ||
      job.posted.toLowerCase() === datePosted.toLowerCase();
    const matchesJobType =
      jobType === "" || job.jobType.toLowerCase() === jobType.toLowerCase();
    const matchesShift =
      workShift === "" || job.shift.toLowerCase() === workShift.toLowerCase();

    const jobSalaryRange = parseSalary(job.salary);
    const selectedSalaryRange = parseRange(salaryRange);

    const matchesSalary =
      !selectedSalaryRange ||
      (jobSalaryRange &&
        jobSalaryRange[1] >= selectedSalaryRange[0] &&
        jobSalaryRange[0] <= selectedSalaryRange[1]);

    return (
      matchesTitle &&
      matchesLocation &&
      matchesDate &&
      matchesSalary &&
      matchesJobType &&
      matchesShift
    );
  });
}

// Toggle pagination visibility
function togglePagination(show) {
  const paginationContainer = document.getElementById("pagination");
  paginationContainer.style.display = show ? "block" : "none";
}

// Function to render jobs on a specific page
function renderPage(page) {
  const startIndex = (page - 1) * jobsPerPage;
  const endIndex = startIndex + jobsPerPage;

  const jobsToShow = carddata.slice(startIndex, endIndex);

  const container = document.getElementById("box-container");
  container.innerHTML = ""; // Clear previous jobs

  if (jobsToShow.length > 0) {
    createJobCards(jobsToShow); // Create job cards for the current page
  } else {
    container.innerHTML = '<p class="no-match">No jobs available</p>';
  }

  renderPagination(); // Render the pagination controls
}

// Function to render pagination controls
function renderPagination() {
  const paginationContainer = document.getElementById("pagination");
  paginationContainer.innerHTML = ""; // Clear previous pagination controls

  const totalPages = Math.ceil(carddata.length / jobsPerPage);

  if (totalPages <= 1) {
    togglePagination(false); // Hide pagination if there's only one page
    return;
  }

  togglePagination(true); // Show pagination if there are multiple pages

  for (let i = 1; i <= totalPages; i++) {
    const button = document.createElement("button");
    button.textContent = i;
    button.className = i === currentPage ? "active" : "";
    button.addEventListener("click", () => {
      currentPage = i;
      renderPage(currentPage); // Re-render the current page
    });
    paginationContainer.appendChild(button);
  }
}

// Function to filter and render jobs based on search input
function renderFilteredJobs() {
  const titleInput = document.querySelector('input[name="title"]').value.trim();
  const locationInput = document
    .querySelector('input[name="location"]')
    .value.trim();
  const dateInput = document
    .querySelector('input[placeholder="date posted"]')
    .value.trim();
  const salaryInput = document
    .querySelector('input[placeholder="Pay"]')
    .value.trim();
  const jobTypeInput = document
    .querySelector('input[placeholder="Job type"]')
    .value.trim();
  const shiftInput = document
    .querySelector('input[placeholder="Work shift"]')
    .value.trim();

  // Ensure all fields are filled
  if (
    !titleInput &&
    !locationInput &&
    !dateInput &&
    !salaryInput &&
    !jobTypeInput &&
    !shiftInput
  ) {
    alert("Please fill all fields to search jobs.");
    return;
  }

  // Perform the filtering
  const filteredJobs = filterJobs(
    carddata,
    titleInput,
    locationInput,
    dateInput,
    salaryInput,
    jobTypeInput,
    shiftInput
  );

  const container = document.getElementById("box-container");
  container.innerHTML = ""; // Clear previous results

  if (filteredJobs.length === 0) {
    container.innerHTML = '<p class="no-match">No match found</p>';
  } else {
    createJobCards(filteredJobs); // Display filtered jobs
  }

  // Hide pagination during search results
  togglePagination(false);
}

// Event listener for search button
document
  .querySelector('input[name="search"]')
  .addEventListener("click", function (event) {
    event.preventDefault(); // Prevent form submission
    renderFilteredJobs();
  });


// Function to clear input fields
function clearInput(fieldName) {
  const inputField = document.querySelector(`input[name="${fieldName}"]`);
  inputField.value = ""; // Clear the input value
  toggleClearCross(fieldName); // Hide the cross after clearing
}

// Function to toggle visibility of the cross
function toggleClearCross(fieldName) {
  const inputField = document.querySelector(`input[name="${fieldName}"]`);
  const cross = inputField.nextElementSibling; // Get the cross (span) next to input field

  if (inputField.value) {
    cross.style.display = "block"; // Show cross if there's value
  } else {
    cross.style.display = "none"; // Hide cross if there's no value
  }
}

// Attach event listeners to input fields to show/hide the cross on user input
document.querySelectorAll('input[type="text"]').forEach((input) => {
  input.addEventListener("input", function () {
    toggleClearCross(input.name); // Show/hide cross based on input value
  });
});



// Function to clear filter
function clearFilter(fieldName) {
  const inputFilter = document.querySelector(`input[name="${fieldName}"]`);
  inputField.value = ""; // Clear the input value
  toggleClearCross(fieldName); // Hide the cross after clearing
}

// Function to toggle visibility of the cross
function toggleClearCross(fieldName) {
  const inputFilter = document.querySelector(`input[name="${fieldName}"]`);
  const cross = inputFilter.nextElementSibling; // Get the cross (span) next to input field

  if (inputFilter.value) {
    cross.style.display = "block"; // Show cross if there's value
  } else {
    cross.style.display = "none"; // Hide cross if there's no value
  }
}

// Attach event listeners to input fields to show/hide the cross on user input
document.querySelectorAll('input[type="text"]').forEach((input) => {
  input.addEventListener("input", function () {
    toggleClearCross(input.name); // Show/hide cross based on input value
  });
});



// Function to handle clearing of selected filter
function clearFilter(filterName) {
  const inputField = document.querySelector(`input[name="${filterName}"]`);
  const lists = inputField.parentElement.querySelector('.lists');
  inputField.value = ''; // Clear the input value
  toggleClearFilter(filterName); // Hide the cross after clearing
  lists.style.display = 'none'; // Close the dropdown list when cleared
}

// Function to toggle visibility of the cross for filters
function toggleClearFilter(filterName) {
  const inputField = document.querySelector(`input[name="${filterName}"]`);
  const cross = inputField.nextElementSibling; // Get the cross (span) next to filter
  
  if (inputField.value) {
    cross.style.display = "block"; // Show cross if there's a selection
  } else {
    cross.style.display = "none"; // Hide cross if there's no selection
  }
}

// Event listeners for dropdown selections
document.querySelectorAll('.dropdown').forEach(dropdown => {
  dropdown.addEventListener('click', function(e) {
    const inputField = dropdown.querySelector('.output');
    
    // If the clicked element is one of the list items
    if (e.target.classList.contains('items')) {
      inputField.value = e.target.textContent; // Set the selected item to the input field
      toggleClearFilter(inputField.name); // Show the cross after selection
      dropdown.querySelector('.lists').style.display = 'none'; // Close the list after selection
    }
    
    // If the clicked element is the input field itself (open the dropdown)
    if (e.target === inputField) {
      const lists = dropdown.querySelector('.lists');
      lists.style.display = lists.style.display === 'block' ? 'none' : 'block'; // Toggle dropdown visibility
    }
  });
});

// Close the dropdown when clicking outside
document.addEventListener('click', function(e) {
  if (!e.target.closest('.dropdown')) {
    document.querySelectorAll('.lists').forEach(list => {
      list.style.display = 'none';
    });
  }
});





// Initialize the job list and pagination
function init() {
  renderPage(currentPage); // Render the first page
}

init();
